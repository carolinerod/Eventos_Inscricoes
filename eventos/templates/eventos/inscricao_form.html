{% extends "eventos/base.html" %}

{% block title %}Inscrição – {{ evento.titulo }}{% endblock %}

{% block content %}
<h2 class="mb-2">{{ evento.titulo }}</h2>
<p class="text-muted mb-3">
  <strong>Quando:</strong> {{ evento.data|date:"d/m/Y H:i" }} &nbsp; | &nbsp;
  <strong>Onde:</strong> {{ evento.local }}
</p>

{% if inscricao %}
  <div class="alert alert-success">
    Inscrição realizada com sucesso!
    <a class="btn btn-sm btn-outline-success ms-2" href="{% url 'ingresso-detail' inscricao.pk %}">Ver meu ingresso</a>
  </div>
{% else %}
  <form method="post" class="col-md-8">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="mb-3">
      {{ form.nome.label_tag }} {{ form.nome }}
    </div>
    <div class="mb-3">
      {{ form.email.label_tag }} {{ form.email }}
    </div>
    <div class="mb-3">
      {{ form.telefone.label_tag }} {{ form.telefone }}
    </div>
    <div class="mb-3">
      <label class="form-label">Você precisa de algum tipo de assistência?</label>
      {{ form.assistencia }}
    </div>
    <div class="mb-3" id="grupo-assistencia-detalhes">
      {{ form.assistencia_detalhes.label_tag }} {{ form.assistencia_detalhes }}
    </div>

    <button type="submit" class="btn btn-success">Confirmar Inscrição</button>
    <a href="{% url 'evento-list' %}" class="btn btn-secondary ms-2">Voltar</a>
  </form>

  <script>
  (function() {
    function toggleDetalhes() {
      const selected = document.querySelector('input[name="assistencia"]:checked, select[name="assistencia"]');
      const detalhesGroup = document.getElementById('grupo-assistencia-detalhes');
      const show = selected && (selected.value === 'OUTRA');
      detalhesGroup.style.display = show ? '' : 'none';
      const textarea = detalhesGroup.querySelector('textarea');
      if (textarea) textarea.disabled = !show;
    }
    document.addEventListener('change', function(e) {
      if (e.target && (e.target.name === 'assistencia')) toggleDetalhes();
    });
    document.addEventListener('DOMContentLoaded', toggleDetalhes);
  })();
  </script>
{% endif %}
{% endblock %}
