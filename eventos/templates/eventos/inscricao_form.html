{% extends 'eventos/base.html' %}
{% load widget_tweaks %}

{% block title %}Inscrição – {{ evento.titulo }}{% endblock %}

{% block content %}
<div class="container mt-4">

  <div class="d-flex align-items-center mb-3">
    <h2 class="mb-0">{{ evento.titulo }}</h2>
    <span class="badge bg-info ms-2">{{ evento.get_tipo_display }}</span>
  </div>

  <p class="text-muted mb-2">
    <strong>Quando:</strong> {{ evento.data|date:"d/m/Y H:i" }} &nbsp; | &nbsp;
    <strong>Onde:</strong> {{ evento.local }}
  </p>

  {% if evento.imagem %}
    <img src="{{ evento.imagem.url }}" alt="Banner do evento" class="img-fluid rounded mb-3" style="max-height: 280px; object-fit: cover;">
  {% endif %}

  {% if evento.observacao_organizador %}
    <div class="alert alert-info">
      <strong>Sobre esta atividade:</strong><br>
      {{ evento.observacao_organizador|linebreaks }}
    </div>
  {% endif %}

  <form method="post" class="mt-3">
    {% csrf_token %}

    <div class="mb-3">
      <label for="{{ form.nome.id_for_label }}" class="form-label">Nome</label>
      {{ form.nome|add_class:"form-control" }}
      {% if form.nome.errors %}<div class="text-danger small">{{ form.nome.errors }}</div>{% endif %}
    </div>

    <div class="mb-3">
      <label for="{{ form.email.id_for_label }}" class="form-label">E-mail</label>
      {{ form.email|add_class:"form-control" }}
      {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors }}</div>{% endif %}
    </div>

    <div class="mb-3">
      <label for="{{ form.telefone.id_for_label }}" class="form-label">Telefone</label>
      {{ form.telefone|add_class:"form-control" }}
      {% if form.telefone.errors %}<div class="text-danger small">{{ form.telefone.errors }}</div>{% endif %}
    </div>

    <div class="mb-3">
      <label class="form-label">Você precisa de algum tipo de assistência?</label>
      {{ form.assistencia }}  {# RadioSelect #}
      {% if form.assistencia.errors %}<div class="text-danger small">{{ form.assistencia.errors }}</div>{% endif %}
    </div>

    <div class="mb-3" id="grupo-assistencia-detalhes">
      <label for="{{ form.assistencia_detalhes.id_for_label }}" class="form-label">Detalhe a assistência</label>
      {{ form.assistencia_detalhes }}
      {% if form.assistencia_detalhes.errors %}<div class="text-danger small">{{ form.assistencia_detalhes.errors }}</div>{% endif %}
    </div>

    <button type="submit" class="btn btn-success">Confirmar Inscrição</button>
    <a href="{% url 'evento-list' %}" class="btn btn-secondary ms-2">Voltar</a>
  </form>

  {% if inscricao %}
    <div class="alert alert-success mt-4 text-center">
      <p class="mb-2"><strong>Inscrição realizada com sucesso!</strong></p>
      <a href="{% url 'ingresso-detail' inscricao.pk %}" class="btn btn-success">Ver meu ingresso</a>
    </div>
  {% endif %}
</div>

<script>
(function() {
  function toggleDetalhes() {
    const selected = document.querySelector('input[name="assistencia"]:checked');
    const detalhesGroup = document.getElementById('grupo-assistencia-detalhes');
    const detalhesInput = document.getElementById('id_assistencia_detalhes');
    const show = selected && selected.value === 'OUTRA';
    detalhesGroup.style.display = show ? '' : 'none';
    if (detalhesInput) detalhesInput.disabled = !show;
  }
  document.addEventListener('change', function(e) {
    if (e.target && e.target.name === 'assistencia') toggleDetalhes();
  });
  document.addEventListener('DOMContentLoaded', toggleDetalhes);
})();
</script>
{% endblock %}
